{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../front/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"searchLayout\">\r\n\t\t<view class=\"search\">\r\n\t\t\t<uni-search-bar @confirm=\"onSearch\" @cancel=\"onClear\" @clear=\"onClear\" focus placeholder=\"搜索\"\r\n\t\t\t\tv-model=\"queryParams.keyword\">\r\n\t\t\t</uni-search-bar>\r\n\t\t</view>\r\n\r\n\r\n\t\t<view v-if=\"!classList.length || noSearch\">\r\n\t\t\t<view class=\"history\" v-if=\"historySearch.length\">\r\n\t\t\t\t<view class=\"topTitle\">\r\n\t\t\t\t\t<view class=\"text\">最近搜索</view>\r\n\t\t\t\t\t<view class=\"icon\" @click=\"removeHistory\">\r\n\t\t\t\t\t\t<uni-icons type=\"trash\" size=\"25\"></uni-icons>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"tabs\">\r\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in historySearch\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"recommend\">\r\n\t\t\t\t<view class=\"topTitle\">\r\n\t\t\t\t\t<view class=\"text\">热门搜索</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"tabs\">\r\n\t\t\t\t\t<view class=\"tab\" v-for=\"tab in recommendList\" :key=\"tab\" @click=\"clickTab(tab)\">{{tab}}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\r\n\t\t<view class=\"noSearch\" v-if=\"noSearch\">\r\n\t\t\t<uv-empty mode=\"search\" icon=\"http://cdn.uviewui.com/uview/empty/search.png\"></uv-empty>\r\n\t\t</view>\r\n\r\n\r\n\t\t<view v-else>\r\n\t\t\t<view class=\"list\">\r\n\t\t\t\t<navigator :url=\"`/pages/preview/preview?id=${item._id}`\" class=\"item\" v-for=\"item in classList\"\r\n\t\t\t\t\t:key=\"item._id\">\r\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\r\n\t\t\t\t</navigator>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"loadingLayout\" v-if=\"noData || classList.length\">\r\n\t\t\t\t<uni-load-more :status=\"noData?'noMore':'loading'\" />\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref\r\n\t} from \"vue\";\r\n\timport {\r\n\t\tonLoad,\r\n\t\tonUnload,\r\n\t\tonReachBottom\r\n\t} from \"@dcloudio/uni-app\";\r\n\timport {\r\n\t\tapiSearchData\r\n\t} from \"@/api/apis.js\"\r\n\t//查询参数\r\n\tconst queryParams = ref({\r\n\t\tpageNum: 1,\r\n\t\tpageSize: 12,\r\n\t\tkeyword: \"\"\r\n\t})\r\n\r\n\t//搜索历史词\r\n\tconst historySearch = ref(uni.getStorageSync(\"historySearch\") || []);\r\n\r\n\t//热门搜索词\r\n\tconst recommendList = ref([\"美女\", \"帅哥\", \"宠物\", \"卡通\"]);\r\n\r\n\t//没有更多\r\n\tconst noData = ref(false);\r\n\t//没有搜索结果\r\n\tconst noSearch = ref(false);\r\n\r\n\t//搜索结果列表\r\n\tconst classList = ref([]);\r\n\r\n\r\n\t//点击搜索\r\n\tconst onSearch = () => {\r\n\t\tuni.showLoading()\r\n\t\thistorySearch.value = [...new Set([queryParams.value.keyword, ...historySearch.value])].slice(0, 10);\r\n\r\n\t\tuni.setStorageSync(\"historySearch\", historySearch.value);\r\n\t\tinitParams(queryParams.value.keyword);\r\n\t\tsearchData();\r\n\t\tconsole.log(queryParams.value.keyword);\r\n\t}\r\n\r\n\t//点击清除按钮\r\n\tconst onClear = () => {\r\n\t\tinitParams();\r\n\t}\r\n\r\n\r\n\r\n\t//点击标签进行搜索\r\n\tconst clickTab = (value) => {\r\n\t\tinitParams(value);\r\n\r\n\t\tonSearch();\r\n\t}\r\n\r\n\r\n\t//点击清空搜索记录\r\n\tconst removeHistory = () => {\r\n\t\tuni.showModal({\r\n\t\t\ttitle: \"是否清空历史搜索？\",\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tuni.removeStorageSync(\"historySearch\");\r\n\t\t\t\t\thistorySearch.value = []\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst searchData = async () => {\r\n\t\ttry {\r\n\t\t\tlet res = await apiSearchData(queryParams.value);\r\n\t\t\tclassList.value = [...classList.value, ...res.data];\r\n\t\t\tuni.setStorageSync(\"storgClassList\", classList.value);\r\n\t\t\tif (queryParams.value.pageSize > res.data.length) noData.value = true;\r\n\t\t\tif (res.data.length == 0 && classList.value.length == 0) noSearch.value = true;\r\n\t\t\tconsole.log(res);\r\n\t\t} finally {\r\n\t\t\tuni.hideLoading()\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tconst initParams = (value = '') => {\r\n\t\tclassList.value = [];\r\n\t\tnoData.value = false;\r\n\t\tnoSearch.value = false;\r\n\t\tqueryParams.value = {\r\n\t\t\tpageNum: 1,\r\n\t\t\tpageSize: 12,\r\n\t\t\tkeyword: value || \"\"\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//触底加载更多\r\n\tonReachBottom(() => {\r\n\t\tif (noData.value) return;\r\n\t\tqueryParams.value.pageNum++\r\n\t\tsearchData();\r\n\t})\r\n\r\n\t//关闭有页面\r\n\tonUnload(() => {\r\n\t\tuni.removeStorageSync(\"storgClassList\", classList.value);\r\n\t})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.searchLayout {\r\n\t\t.search {\r\n\t\t\tpadding: 0 10rpx;\r\n\t\t}\r\n\r\n\t\t.topTitle {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: center;\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tcolor: #999;\r\n\t\t}\r\n\r\n\t\t.history {\r\n\t\t\tpadding: 30rpx;\r\n\t\t}\r\n\r\n\t\t.recommend {\r\n\t\t\tpadding: 30rpx;\r\n\t\t}\r\n\r\n\t\t.tabs {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tflex-wrap: wrap;\r\n\t\t\tpadding-top: 20rpx;\r\n\r\n\t\t\t.tab {\r\n\t\t\t\tbackground: #F4F4F4;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tpadding: 10rpx 28rpx;\r\n\t\t\t\tborder-radius: 50rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\tmargin-top: 20rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.list {\r\n\t\t\tdisplay: grid;\r\n\t\t\tgrid-template-columns: repeat(3, 1fr);\r\n\t\t\tgap: 5rpx;\r\n\t\t\tpadding: 20rpx 5rpx;\r\n\r\n\t\t\t.item {\r\n\t\t\t\theight: 440rpx;\r\n\r\n\t\t\t\timage {\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/JiuBingWallPaper/wallpaper/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiSearchData","onReachBottom","onUnload"],"mappings":";;;;;;;;;;;;;;;;;;;;AAmEC,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAE;AAGD,UAAM,gBAAgBA,cAAAA,IAAIC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AAGnE,UAAM,gBAAgBD,cAAAA,IAAI,CAAC,MAAM,MAAM,MAAM,IAAI,CAAC;AAGlD,UAAM,SAASA,kBAAI,KAAK;AAExB,UAAM,WAAWA,kBAAI,KAAK;AAG1B,UAAM,YAAYA,kBAAI,CAAA,CAAE;AAIxB,UAAM,WAAW,MAAM;AACtBC,oBAAAA,MAAI,YAAa;AACjB,oBAAc,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,cAAc,KAAK,CAAC,CAAC,EAAE,MAAM,GAAG,EAAE;AAEnGA,oBAAAA,MAAI,eAAe,iBAAiB,cAAc,KAAK;AACvD,iBAAW,YAAY,MAAM,OAAO;AACpC;AACAA,oBAAA,MAAA,MAAA,OAAA,iCAAY,YAAY,MAAM,OAAO;AAAA,IACrC;AAGD,UAAM,UAAU,MAAM;AACrB;IACA;AAKD,UAAM,WAAW,CAAC,UAAU;AAC3B,iBAAW,KAAK;AAEhB;IACA;AAID,UAAM,gBAAgB,MAAM;AAC3BA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,SAAO;AACf,cAAI,IAAI,SAAS;AAChBA,gCAAI,kBAAkB,eAAe;AACrC,0BAAc,QAAQ,CAAE;AAAA,UACxB;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAED,UAAM,aAAa,YAAY;AAC9B,UAAI;AACH,YAAI,MAAM,MAAMC,SAAAA,cAAc,YAAY,KAAK;AAC/C,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,IAAI;AAClDD,sBAAAA,MAAI,eAAe,kBAAkB,UAAU,KAAK;AACpD,YAAI,YAAY,MAAM,WAAW,IAAI,KAAK;AAAQ,iBAAO,QAAQ;AACjE,YAAI,IAAI,KAAK,UAAU,KAAK,UAAU,MAAM,UAAU;AAAG,mBAAS,QAAQ;AAC1EA,sBAAAA,MAAY,MAAA,OAAA,kCAAA,GAAG;AAAA,MAClB,UAAY;AACTA,sBAAAA,MAAI,YAAa;AAAA,MACjB;AAAA,IAED;AAED,UAAM,aAAa,CAAC,QAAQ,OAAO;AAClC,gBAAU,QAAQ;AAClB,aAAO,QAAQ;AACf,eAAS,QAAQ;AACjB,kBAAY,QAAQ;AAAA,QACnB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS,SAAS;AAAA,MAClB;AAAA,IACD;AAIDE,kBAAAA,cAAc,MAAM;AACnB,UAAI,OAAO;AAAO;AAClB,kBAAY,MAAM;AAClB;IACF,CAAE;AAGDC,kBAAAA,SAAS,MAAM;AACdH,oBAAAA,MAAI,kBAAkB,kBAAkB,UAAU,KAAK;AAAA,IACzD,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClKF,GAAG,WAAW,eAAe;"}